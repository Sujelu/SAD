<!DOCTYPE html>
<html lang="it">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>S.A.D. | Arcade Extreme</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body, html { height: 100%; overflow: hidden; font-family: 'Courier New', monospace; background: #000; color: #fff; }
        canvas { display: block; background: #111; }
        .overlay { position: absolute; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.95); display: flex; flex-direction: column; align-items: center; justify-content: center; z-index: 100; }
        .overlay h1 { font-size: 70px; margin-bottom: 20px; text-shadow: 0 0 30px #0ff, 0 0 60px #0ff; animation: glitch 1.5s; }
        @keyframes glitch { 0%,100% { text-shadow: 0 0 30px #0ff, 0 0 60px #0ff; } 50% { text-shadow: 0 0 40px #f0f, 0 0 80px #f0f; } }
        button { padding: 18px 40px; font-size: 28px; font-weight: bold; color: #000; background: linear-gradient(45deg, #0ff, #0f0); border: none; border-radius: 15px; cursor: pointer; transition: all 0.3s; box-shadow: 0 0 30px #0ff; }
        button:hover { transform: scale(1.15); box-shadow: 0 0 50px #0ff; }
        #info { position: absolute; top: 15px; left: 15px; display: flex; gap: 15px; z-index: 50; }
        .score-box { background: rgba(0,0,0,0.7); padding: 12px 22px; border-radius: 12px; border: 2px solid #0ff; font-size: 20px; font-weight: bold; min-width: 140px; text-align: center; box-shadow: 0 0 20px #0ff; }
        .score-zone { position: absolute; bottom: 0; height: 70px; width: 100%; display: flex; border-top: 4px solid #0ff; }
        .score-zone div { flex: 1; display: flex; align-items: center; justify-content: center; font-size: 22px; font-weight: bold; background: rgba(0,0,0,0.8); border-left: 1px solid #0ff; border-right: 1px solid #0ff; text-shadow: 0 0 12px #fff; }
        .score-zone div.ball-zone { background: rgba(0,255,0,0.3); color: #0f0; text-shadow: 0 0 15px #0f0; }
        .level-up { position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); font-size: 90px; font-weight: bold; color: gold; text-shadow: 0 0 40px yellow, 0 0 80px orange; opacity: 0; pointer-events: none; z-index: 90; }
        .score-popup { position: absolute; font-weight: bold; font-size: 28px; color: gold; text-shadow: 0 0 15px #ff0; pointer-events: none; animation: floatUp 1.2s forwards; z-index: 70; }
        @keyframes floatUp { 0% { transform: translateY(0); opacity: 1; } 100% { transform: translateY(-60px); opacity: 0; } }
        .combo-text { position: absolute; top: 90px; left: 50%; transform: translateX(-50%); font-size: 56px; font-weight: bold; color: #ff0; text-shadow: 0 0 25px #ff0; opacity: 0; transition: opacity 0.3s; z-index: 60; }
        .sad-logo { position: absolute; top: 15px; right: 15px; font-size: 16px; color: #0ff; text-shadow: 0 0 15px #0ff; z-index: 50; opacity: 0.9; }
        .track-info { position: absolute; bottom: 90px; left: 20px; font-size: 16px; color: #0ff; text-shadow: 0 0 10px #0ff; z-index: 50; }
        .debug { position: absolute; top: 10px; right: 150px; color: #0f0; font-size: 14px; z-index: 100; background: rgba(0,0,0,0.5); padding: 5px; border-radius: 5px; }
    </style>
</head>
<body>

    <canvas id="plinkoCanvas"></canvas>

    <div class="sad-logo">S.A.D. EXTREME<br>by Dr.Sujelu</div>
    <div class="debug" id="debug">Audio: In attesa del click...</div>

    <div class="overlay" id="startOverlay">
        <h1>ROBOPLINKO</h1>
        <h2 style="font-size: 32px; color: #0ff; margin-bottom: 20px;">EXTREME</h2>
        <button id="startButton">INIZIA</button>
        <div style="margin-top: 30px; color: #0ff; font-size: 20px;">
            HI-SCORE: <span id="hiScoreDisplay">000000</span>
        </div>
    </div>

    <div class="overlay" id="gameOverOverlay" style="display: none;">
        <h1>GAME OVER</h1>
        <div style="margin: 20px 0; font-size: 36px; color: gold;">
            SCORE: <span id="finalScore">0</span>
        </div>
        <button id="restartButton">RIVINCITA</button>
    </div>

    <div id="info">
        <div class="score-box">Palline: <span id="remainingBalls">50</span></div>
        <div class="score-box">Score: <span id="score">0</span></div>
        <div class="score-box">Picco: <span id="highScore">0</span></div>
        <div class="score-box">Livello: <span id="level">1</span></div>
    </div>

    <div class="score-zone">
        <div>-500</div><div>+10</div><div>+20</div><div class="ball-zone">+1 BALL</div>
        <div>-1000</div><div>5000</div><div>-1000</div><div class="ball-zone">+1 BALL</div>
        <div>40</div><div>75</div><div class="ball-zone">+1 BALL</div>
    </div>

    <div class="level-up" id="levelUpMessage">LEVEL UP!</div>
    <div class="combo-text" id="comboText"></div>
    <div class="track-info" id="trackInfo">Livello 1 – Intro</div>

    <!-- AUDIO – GARANTITO -->
    <audio id="dropSound" preload="auto"></audio>
    <audio id="bounce1" preload="auto"></audio>
    <audio id="bounce2" preload="auto"></audio>
    <audio id="bounce3" preload="auto"></audio>
    <audio id="bounce4" preload="auto"></audio>
    <audio id="bounce5" preload="auto"></audio>
    <audio id="bonusClickSound" preload="auto"></audio>
    <audio id="bonusCompleteSound" preload="auto"></audio>
    <audio id="powerupSpawnSound" preload="auto"></audio>
    <audio id="powerupCollectSound" preload="auto"></audio>
    <audio id="explosionSound" preload="auto"></audio>
    <audio id="levelUpSound" preload="auto"></audio>
    <audio id="gameOverSound" preload="auto"></audio>
    <audio id="bgTrack" preload="auto" loop></audio>

    <script>
        // === ELEMENTI ===
        const canvas = document.getElementById('plinkoCanvas');
        const ctx = canvas.getContext('2d');
        const debug = document.getElementById('debug');
        const startOverlay = document.getElementById('startOverlay');
        const startButton = document.getElementById('startButton');
        const gameOverOverlay = document.getElementById('gameOverOverlay');
        const restartButton = document.getElementById('restartButton');
        const remainingBallsDisplay = document.getElementById('remainingBalls');
        const scoreDisplay = document.getElementById('score');
        const highScoreDisplay = document.getElementById('highScore');
        const hiScoreDisplay = document.getElementById('hiScoreDisplay');
        const levelDisplay = document.getElementById('level');
        const levelUpMessage = document.getElementById('levelUpMessage');
        const comboText = document.getElementById('comboText');
        const finalScoreDisplay = document.getElementById('finalScore');
        const trackInfo = document.getElementById('trackInfo');

        // === AUDIO ===
        const audioFiles = {
            dropSound: "audio/drop.wav",
            bounce1: "audio/bounce1.wav",
            bounce2: "audio/bounce2.wav",
            bounce3: "audio/bounce3.wav",
            bounce4: "audio/bounce4.wav",
            bounce5: "audio/bounce5.wav",
            bonusClickSound: "audio/bonus_click.wav",
            bonusCompleteSound: "audio/bonus_complete.mp3",
            powerupSpawnSound: "audio/powerup_spawn.wav",
            powerupCollectSound: "audio/powerup_collect.wav",
            explosionSound: "audio/explosion.wav",
            levelUpSound: "audio/level_up.wav",
            gameOverSound: "audio/game_over.mp3"
        };

        const sounds = {};
        let audioUnlocked = false;
        let currentBounce = 0;

        // Carica tutti i suoni
        Object.keys(audioFiles).forEach(key => {
            const audio = document.getElementById(key);
            audio.src = audioFiles[key];
            audio.load();
            sounds[key] = audio;
        });

        // Sblocca audio al primo click
        canvas.addEventListener('click', function unlockAudio(e) {
            if (audioUnlocked) return;
            audioUnlocked = true;
            debug.innerText = "Audio: Sbloccato!";
            debug.style.color = "#0f0";
            playSound('dropSound');
            playBgTrack();
            canvas.removeEventListener('click', unlockAudio);
        }, { once: true });

        // Suoni
        function playSound(id) {
            if (!audioUnlocked) return;
            const sound = sounds[id];
            if (sound) {
                sound.currentTime = 0;
                sound.play().catch(() => {});
            }
        }

        function playBounce() {
            if (!audioUnlocked) return;
            const bounceKeys = ['bounce1', 'bounce2', 'bounce3', 'bounce4', 'bounce5'];
            const sound = sounds[bounceKeys[currentBounce % 5]];
            sound.currentTime = 0;
            sound.play().catch(() => {});
            currentBounce++;
        }

        // Background
        const bgTracks = ["bg1.mp3", "bg2.mp3", "bg3.mp3", "bg4.mp3"];
        function playBgTrack() {
            if (!audioUnlocked) return;
            const track = bgTracks[(currentLevel - 1) % bgTracks.length];
            const bg = sounds.bgTrack;
            bg.src = "audio/" + track;
            bg.load();
            bg.volume = 0.6;
            bg.play().catch(() => {});
            trackInfo.innerText = `Livello ${currentLevel} – ${track}`;
        }

        // === COSTANTI ===
        const CHIODINO_RADIUS = 5, PALLINA_RADIUS = 5;
        let GRAVITY_Y = 0.5;
        const ZONE_HEIGHT = 70;
        const SCORE_ZONES = [-500, 10, 20, 0, ...
