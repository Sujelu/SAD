<!DOCTYPE html>
<html lang="it">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>S.A.D. | RoboPlinko Xtreme</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body, html {
            height: 100%; overflow: hidden;
            font-family: 'Courier New', monospace;
            background: #000; color: #fff;
        }
        canvas { display: block; background: #111; }
        .overlay {
            position: absolute; top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(0,0,0,0.9); display: flex; flex-direction: column;
            align-items: center; justify-content: center; z-index: 100;
        }
        .overlay h1 {
            font-size: 60px; margin-bottom: 20px;
            text-shadow: 0 0 20px #0ff, 0 0 40px #0ff;
            animation: glitch 2s infinite;
        }
        @keyframes glitch {
            0%,100% { text-shadow: 0 0 20px #0ff, 0 0 40px #0ff; }
            50% { text-shadow: 0 0 30px #f0f, 0 0 60px #f0f; }
        }
        button {
            padding: 15px 30px; font-size: 24px; font-weight: bold;
            color: #000; background: linear-gradient(45deg, #0ff, #0f0);
            border: none; border-radius: 12px; cursor: pointer;
            transition: all 0.3s; box-shadow: 0 0 20px #0ff;
        }
        button:hover { transform: scale(1.1); box-shadow: 0 0 40px #0ff; }
        #info {
            position: absolute; top: 15px; left: 15px; display: flex; gap: 15px; z-index: 50;
        }
        .score-box {
            background: rgba(0,0,0,0.7); padding: 10px 20px; border-radius: 10px;
            border: 2px solid #0ff; font-size: 18px; font-weight: bold;
            min-width: 120px; text-align: center; box-shadow: 0 0 15px #0ff;
        }
        .score-zone {
            position: absolute; bottom: 0; height: 60px; width: 100%;
            display: flex; border-top: 3px solid #0ff;
        }
        .score-zone div {
            flex: 1; display: flex; align-items: center; justify-content: center;
            font-size: 20px; font-weight: bold; background: rgba(0,0,0,0.8);
            border-left: 1px solid #0ff; border-right: 1px solid #0ff;
            text-shadow: 0 0 10px #fff;
        }
        .level-up {
            position: absolute; top: 50%; left: 50%;
            transform: translate(-50%, -50%); font-size: 80px; font-weight: bold;
            color: gold; text-shadow: 0 0 30px yellow, 0 0 60px orange;
            opacity: 0; pointer-events: none; z-index: 90;
        }
        .explosion {
            position: absolute; width: 100px; height: 100px;
            background: radial-gradient(circle, yellow, orange, red);
            border-radius: 50%; pointer-events: none;
            animation: explode 0.6s forwards; z-index: 80;
        }
        @keyframes explode { 0% { transform: scale(0.5); opacity: 1; } 100% { transform: scale(4); opacity: 0; } }
        .score-popup {
            position: absolute; font-weight: bold; font-size: 24px; color: gold;
            text-shadow: 0 0 10px #ff0; pointer-events: none;
            animation: floatUp 1s forwards; z-index: 70;
        }
        @keyframes floatUp { 0% { transform: translateY(0); opacity: 1; } 100% { transform: translateY(-50px); opacity: 0; } }
        .combo-text {
            position: absolute; top: 80px; left: 50%; transform: translateX(-50%);
            font-size: 48px; font-weight: bold; color: #ff0;
            text-shadow: 0 0 20px #ff0; opacity: 0; transition: opacity 0.3s; z-index: 60;
        }
        .sad-logo {
            position: absolute; top: 15px; right: 15px; font-size: 14px; color: #0ff;
            text-shadow: 0 0 10px #0ff; z-index: 50; opacity: 0.8;
        }
        .spotify-btn {
            position: absolute; bottom: 80px; right: 20px;
            background: #1DB954; color: white; padding: 15px; border-radius: 50%;
            font-weight: bold; box-shadow: 0 0 20px #1DB954; cursor: pointer;
            animation: pulse 2s infinite;
        }
        @keyframes pulse { 0% { transform: scale(1); } 50% { transform: scale(1.1); } 100% { transform: scale(1); } }
    </style>
</head>
<body>

    <canvas id="plinkoCanvas"></canvas>

    <!-- S.A.D. LOGO -->
    <div class="sad-logo">S.A.D. ARCADE DIVISION<br>by Dr.Sujelu</div>

    <!-- TITLE SCREEN -->
    <div class="overlay" id="startOverlay">
        <h1>ROBOPLINKO XTREME 000</h1>
        <button id="startButton">START GAME</button>
        <div style="margin-top: 20px; color: #0ff; font-size: 18px;">
            HI-SCORE: <span id="hiScoreDisplay">000000</span>
        </div>
    </div>

    <!-- GAME OVER -->
    <div class="overlay" id="gameOverOverlay" style="display: none;">
        <h1>GAME OVER</h1>
        <div style="margin: 20px 0; font-size: 32px; color: gold;">
            SCORE: <span id="finalScore">0</span>
        </div>
        <button id="restartButton">VENDETTA</button>
    </div>

    <!-- HUD -->
    <div id="info">
        <div class="score-box">Palline: <span id="remainingBalls">30</span></div>
        <div class="score-box">Score: <span id="score">0</span></div>
        <div class="score-box">Picco: <span id="highScore">0</span></div>
        <div class="score-box">Livello: <span id="level">1</span></div>
    </div>

    <!-- SCORE ZONES -->
    <div class="score-zone">
        <div>-500</div><div>+10</div><div>+20</div><div>150</div>
        <div>-1000</div><div>5000</div><div>-1000</div><div>150</div>
        <div>40</div><div>75</div><div>-500</div>
    </div>

    <!-- LEVEL UP -->
    <div class="level-up" id="levelUpMessage">LEVEL UP!</div>

    <!-- COMBO -->
    <div class="combo-text" id="comboText"></div>

    <!-- STREAM BUTTON -->
    <button class="spotify-btn" onclick="streamToUnlock()">
        STREAM = +5
    </button>

    <!-- AUDIO CUSTOM -->
    <audio id="dropSound" src="https://downloads.wetransfer.com/.../drop.wav" preload="auto"></audio>
    <audio id="bounceSound" src="https://downloads.wetransfer.com/.../bounce.wav" preload="auto"></audio>
    <audio id="bonusClickSound" src="https://downloads.wetransfer.com/.../bonus_click.wav" preload="auto"></audio>
    <audio id="bonusCompleteSound" src="https://downloads.wetransfer.com/.../bonus_complete.wav" preload="auto"></audio>
    <audio id="powerupSpawnSound" src="https://downloads.wetransfer.com/.../powerup_spawn.wav" preload="auto"></audio>
    <audio id="powerupCollectSound" src="https://downloads.wetransfer.com/.../powerup_collect.wav" preload="auto"></audio>
    <audio id="explosionSound" src="https://downloads.wetransfer.com/.../explosion.wav" preload="auto"></audio>
    <audio id="levelUpSound" src="https://downloads.wetransfer.com/.../level_up.wav" preload="auto"></audio>

    <script>
        // === ELEMENTI ===
        const canvas = document.getElementById('plinkoCanvas');
        const ctx = canvas.getContext('2d');
        const startOverlay = document.getElementById('startOverlay');
        const startButton = document.getElementById('startButton');
        const gameOverOverlay = document.getElementById('gameOverOverlay');
        const restartButton = document.getElementById('restartButton');
        const remainingBallsDisplay = document.getElementById('remainingBalls');
        const scoreDisplay = document.getElementById('score');
        const highScoreDisplay = document.getElementById('highScore');
        const hiScoreDisplay = document.getElementById('hiScoreDisplay');
        const levelDisplay = document.getElementById('level');
        const levelUpMessage = document.getElementById('levelUpMessage');
        const comboText = document.getElementById('comboText');
        const finalScoreDisplay = document.getElementById('finalScore');

        // === AUDIO ===
        const dropSound = document.getElementById('dropSound');
        const bounceSound = document.getElementById('bounceSound');
        const bonusClickSound = document.getElementById('bonusClickSound');
        const bonusCompleteSound = document.getElementById('bonusCompleteSound');
        const powerupSpawnSound = document.getElementById('powerupSpawnSound');
        const powerupCollectSound = document.getElementById('powerupCollectSound');
        const explosionSound = document.getElementById('explosionSound');
        const levelUpSound = document.getElementById('levelUpSound');

        // === PENTATONIC BOUNCE (5 toni) ===
        const bounceNotes = [0, 3, 5, 7, 10]; // Scala pentatonica
        let currentNote = 0;

        // === COSTANTI E VARIABILI ===
        const CHIODINO_RADIUS = 5, PALLINA_RADIUS = 5;
        let GRAVITY_Y = 0.5;
        const ZONE_HEIGHT = 60;
        const SCORE_ZONES = [-500, 10, 20, 150, -1000, 5000, -1000, 150, 40, 75, -500];
        const LEVEL_THEMES = [
            { bg: "#111", peg: "#888", ball: "orange", glow: "#555" },
            { bg: "#0a0a23", peg: "#00ff41", ball: "#00ffff", glow: "#0f0" },
            { bg: "#230023", peg: "#ff00ff", ball: "#ff4400", glow: "#f0f" },
            { bg: "#330000", peg: "#ffff00", ball: "white", glow: "#ff0" }
        ];

        let CHIODINI = [], PALLINE = [], BONUS = [], POWERUPS_ACTIVE = [], particles = [];
        let score = 0, highScore = 0, remainingBalls = 30, gameOver = false;
        let currentLevel = 0, levelThreshold = 5000;
        let bonusClickCount = 0, combo = 0, comboMultiplier = 1;
        let shakeIntensity = 0;

        highScore = parseInt(localStorage.getItem('sadPlinkoHiScore') || '0');
        highScoreDisplay.innerText = highScore.toString().padStart(6, '0');
        hiScoreDisplay.innerText = highScore.toString().padStart(6, '0');

        // === RESIZE ===
        function resizeCanvas() {
            canvas.width = window.innerWidth;
            canvas.height = window.innerHeight;
            generateChiodini();
        }
        window.addEventListener('resize', resizeCanvas);
        resizeCanvas();

        // === GENERA CHIODINI ===
        function generateChiodini() {
            CHIODINI = [];
            const rows = 18, cols = 22;
            const spacingX = canvas.width / cols;
            const spacingY = (canvas.height - ZONE_HEIGHT - 100) / rows;
            for (let y = 0; y < rows; y++) {
                for (let x = 0; x < cols; x++) {
                    const offsetX = (y % 2 === 0) ? spacingX / 2 : 0;
                    CHIODINI.push({
                        x: x * spacingX + offsetX,
                        y: y * spacingY + 80,
                        glow: Math.random() * 0.7 + 0.3
                    });
                }
            }
        }

        // === CREA PALLINA ===
        function createPallina(x) {
            if (remainingBalls <= 0 && !gameOver) return;
            PALLINE.push({
                x, y: 10,
                speedX: (Math.random() - 0.5) * 1,
                speedY: 0,
                landed: false,
                color: LEVEL_THEMES[currentLevel].ball
            });
            if (!gameOver) remainingBalls--;
            remainingBallsDisplay.innerText = remainingBalls;
            combo++;
            showCombo();
            dropSound.currentTime = 0;
            dropSound.play().catch(() => {});
        }

        // === RIMBALZO PENTATONICO ===
        function playBounce() {
            bounceSound.currentTime = 0;
            bounceSound.playbackRate = Math.pow(2, bounceNotes[currentNote % 5] / 12);
            bounceSound.play().catch(() => {});
            currentNote++;
        }

        // === UPDATE PALLINE (con bounce sound) ===
        function updatePalline() {
            PALLINE = PALLINE.filter(p => {
                if (p.landed) return true;
                p.speedY += GRAVITY_Y;
                p.y += p.speedY;
                p.x += p.speedX;

                if (p.x < PALLINA_RADIUS || p.x > canvas.width - PALLINA_RADIUS) {
                    p.speedX *= -0.9;
                }

                CHIODINI.forEach(c => {
                    const dist = Math.hypot(c.x - p.x, c.y - p.y);
                    if (dist < CHIODINO_RADIUS + PALLINA_RADIUS) {
                        p.speedY *= -0.8;
                        p.speedX += (Math.random() - 0.5) * 1.5;
                        createParticles(p.x, p.y, 3, '#fff');
                        playBounce(); // PENTATONICA!
                    }
                });

                if (p.y >= canvas.height - ZONE_HEIGHT) {
                    p.landed = true;
                    const zoneWidth = canvas.width / SCORE_ZONES.length;
                    const zoneIndex = Math.floor(p.x / zoneWidth);
                    let points = SCORE_ZONES[zoneIndex] || 0;
                    const total = points * combo * comboMultiplier;
                    score += total;
                    showScorePopup(p.x, p.y, total > 0 ? `+${total}` : total);
                    combo = 0;
                    hideCombo();
                }
                return p.y < canvas.height + 50;
            });
        }

        // === STREAM TO UNLOCK ===
        function streamToUnlock() {
            const spotifyTrack = "https://open.spotify.com/track/INSERISCI_ID_BRANO"; // SOSTITUISCI
            window.open(spotifyTrack, '_blank');
            setTimeout(() => {
                remainingBalls += 5;
                remainingBallsDisplay.innerText = remainingBalls;
                showScorePopup(canvas.width/2, 100, '+5 BALLS (STREAM!)');
                createParticles(canvas.width/2, 100, 30, '#1DB954');
            }, 30000);
        }

        // === LEVEL UP CON TUA REMAKE ===
        if (score >= levelThreshold) {
            currentLevel = Math.min(currentLevel + 1, LEVEL_THEMES.length - 1);
            levelThreshold += 8000;
            levelDisplay.innerText = currentLevel + 1;
            showLevelUp();
            createParticles(canvas.width/2, 100, 60, 'gold');
            shakeIntensity = 15;
            createPowerUp();
            levelUpSound.currentTime = 0;
            levelUpSound.play().catch(() => {});
        }

        // === AVVIO ===
        function startGame() {
            score = 0; remainingBalls = 30; gameOver = false;
            currentLevel = 0; levelThreshold = 5000;
            combo = 0; comboMultiplier = 1; bonusClickCount = 0;
            PALLINE = []; BONUS = []; POWERUPS_ACTIVE = []; particles = [];
            GRAVITY_Y = 0.5; currentNote = 0;

            generateChiodini();
            createBonus();
            setInterval(createBonus, 30000);

            startOverlay.style.display = 'none';
            gameOverOverlay.style.display = 'none';

            remainingBallsDisplay.innerText = remainingBalls;
            scoreDisplay.innerText = '000000';
            levelDisplay.innerText = '1';

            requestAnimationFrame(update);
        }

        startButton.addEventListener('click', startGame);
        restartButton.addEventListener('click', startGame);

        // ... (resto del codice: update, draw, click, etc. identico ma con suoni)
    </script>
</body>
</html>
